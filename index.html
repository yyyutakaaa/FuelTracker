<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bereken brandstofkosten voor uw reis met actuele prijzen en routeplanning">
    <meta name="theme-color" content="#ffffff">
    <title>FuelTracker - Brandstofkosten Calculator</title>

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="min-h-screen bg-white text-gray-900 transition-colors duration-200">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="text-gray-600 dark:text-gray-400">Laden...</p>
        </div>
    </div>

    <!-- Navigation - Ultra Modern -->
    <nav>
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-gas-pump text-xl text-white"></i>
                    </div>
                    <span class="text-2xl font-bold text-gradient">FuelTracker</span>
                </div>

                <div class="hidden md:flex items-center space-x-2">
                    <a href="#calculator" class="nav-link">
                        <i class="fas fa-calculator mr-2"></i>Calculator
                    </a>
                    <a href="#history" class="nav-link">
                        <i class="fas fa-history mr-2"></i>Geschiedenis
                    </a>
                    <a href="#chart" class="nav-link">
                        <i class="fas fa-chart-line mr-2"></i>Statistieken
                    </a>
                </div>

                <button class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition" id="mobileMenuBtn">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden border-t border-gray-100">
            <div class="container mx-auto px-4 py-3 space-y-2">
                <a href="#calculator" class="block py-3 nav-link">
                    <i class="fas fa-calculator mr-2"></i>Calculator
                </a>
                <a href="#history" class="block py-3 nav-link">
                    <i class="fas fa-history mr-2"></i>Geschiedenis
                </a>
                <a href="#chart" class="block py-3 nav-link">
                    <i class="fas fa-chart-line mr-2"></i>Statistieken
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="app" class="container mx-auto px-4 py-8">
        <!-- Calculator Section -->
        <section id="calculator" class="modern-card mb-8 animate-fade-in">
            <h1 class="text-3xl font-bold mb-8 flex items-center">
                <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mr-4 shadow-lg">
                    <i class="fas fa-calculator text-xl text-white"></i>
                </div>
                <span class="text-gradient">Brandstofkosten Calculator</span>
            </h1>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Departure Input -->
                <div class="relative">
                    <label>Vertrekpunt</label>
                    <div class="relative">
                        <input
                            type="text"
                            v-model="departure"
                            @input="searchDeparture"
                            @focus="departureFocused = true"
                            @blur="handleDepartureBlur"
                            placeholder="Straat, stad of postcode..."
                            required
                        >
                        <i class="fas fa-map-marker-alt absolute right-4 top-4 text-gray-400"></i>
                    </div>

                    <!-- Departure Suggestions -->
                    <div v-if="departureSuggestions.length > 0 && departureFocused"
                         class="autocomplete-dropdown">
                        <div v-for="(suggestion, index) in departureSuggestions"
                             :key="index"
                             @click="selectDeparture(suggestion)"
                             class="autocomplete-item">
                            <div class="font-semibold text-gray-900">{{ suggestion.name }}</div>
                            <div class="text-sm text-gray-500">{{ suggestion.display_name }}</div>
                        </div>
                    </div>
                </div>

                <!-- Destination Input -->
                <div class="relative">
                    <label>Bestemming</label>
                    <div class="relative">
                        <input
                            type="text"
                            v-model="destination"
                            @input="searchDestination"
                            @focus="destinationFocused = true"
                            @blur="handleDestinationBlur"
                            placeholder="Straat, stad of postcode..."
                            required
                        >
                        <i class="fas fa-map-marker-alt absolute right-4 top-4 text-gray-400"></i>
                    </div>

                    <!-- Destination Suggestions -->
                    <div v-if="destinationSuggestions.length > 0 && destinationFocused"
                         class="autocomplete-dropdown">
                        <div v-for="(suggestion, index) in destinationSuggestions"
                             :key="index"
                             @click="selectDestination(suggestion)"
                             class="autocomplete-item">
                            <div class="font-semibold text-gray-900">{{ suggestion.name }}</div>
                            <div class="text-sm text-gray-500">{{ suggestion.display_name }}</div>
                        </div>
                    </div>
                </div>
                
                <!-- Fuel Consumption Input -->
                <div>
                    <label>Brandstofverbruik (L/100km)</label>
                    <div class="relative">
                        <input
                            type="number"
                            v-model.number="consumption"
                            min="2"
                            max="25"
                            step="0.1"
                            placeholder="Bijv. 6.5"
                            required
                        >
                        <i class="fas fa-gas-pump absolute right-4 top-4 text-gray-400"></i>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Gemiddeld: 5-8 L/100km</p>
                </div>

                <!-- Fuel Type Select -->
                <div>
                    <label>Brandstoftype</label>
                    <select v-model="fuelType">
                        <option value="euro95">Euro 95 (E10)</option>
                        <option value="euro98">Euro 98 (E5)</option>
                        <option value="diesel">Diesel (B7)</option>
                        <option value="lpg">LPG</option>
                    </select>
                </div>

                <!-- Gas Station Select -->
                <div>
                    <label>Tankstation</label>
                    <select v-model="gasStation">
                        <option value="average">Gemiddelde prijs</option>
                        <option value="shell">Shell</option>
                        <option value="totalenergies">TotalEnergies</option>
                        <option value="q8">Q8</option>
                        <option value="esso">Esso</option>
                        <option value="gabriels">Gabriels</option>
                        <option value="octaplus">Octa+</option>
                        <option value="dats24">Dats 24</option>
                        <option value="lukoil">Lukoil</option>
                        <option value="custom">Aangepaste prijs</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-2">Selecteer je voorkeur tankstation voor tracking</p>
                </div>

                <!-- Custom Price Input -->
                <div v-if="gasStation === 'custom'">
                    <label>Aangepaste brandstofprijs (â‚¬/L)</label>
                    <div class="relative">
                        <input
                            type="number"
                            v-model.number="customPrice"
                            min="0.5"
                            max="5"
                            step="0.001"
                            placeholder="Bijv. 1.599"
                            required
                        >
                        <i class="fas fa-euro-sign absolute right-4 top-4 text-gray-400"></i>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Vul de prijs in die je bij het tankstation zag</p>
                </div>
            </div>
            
            <!-- Fuel Price Display -->
            <div v-if="currentFuelPrice" class="mt-6 price-display animate-fade-in">
                <div class="flex items-center justify-between relative z-10">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-gas-pump mr-3 text-2xl opacity-90"></i>
                            <div>
                                <div class="text-sm font-medium opacity-90">Huidige Brandstofprijs</div>
                                <div v-if="gasStation !== 'average'" class="text-xs opacity-75">{{ getStationName(gasStation) }}</div>
                            </div>
                        </div>
                        <div class="price-value">â‚¬ {{ currentFuelPrice.toFixed(3) }}<span class="text-2xl opacity-75">/L</span></div>
                    </div>
                    <button
                        @click="refreshFuelPrice"
                        :disabled="isRefreshingPrice"
                        class="bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white px-4 py-2 rounded-xl transition-all flex items-center font-medium shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                        title="Ververs brandstofprijs"
                    >
                        <i class="fas fa-sync-alt mr-2" :class="{ 'animate-spin': isRefreshingPrice }"></i>
                        <span v-if="!isRefreshingPrice">Ververs</span>
                        <span v-else>Laden...</span>
                    </button>
                </div>
                <div class="mt-4 pt-4 border-t border-white/20 relative z-10">
                    <div class="text-xs opacity-90 flex items-center">
                        <i class="fas fa-clock mr-2"></i>
                        Laatst bijgewerkt: {{ lastPriceUpdate }}
                    </div>
                    <div class="text-xs opacity-75 mt-1">
                        <i class="fas fa-info-circle mr-2"></i>
                        <span v-if="gasStation === 'custom'">Aangepaste prijs ingevoerd</span>
                        <span v-else>OfficiÃ«le StatBel API data â€¢ Auto-update elke 6u</span>
                    </div>
                </div>
            </div>
            
            <!-- Calculate Button - Modern -->
            <button
                @click="calculateTrip"
                :disabled="isCalculating || !departure || !destination || !consumption"
                class="w-full mt-8 py-4 btn-primary flex items-center justify-center text-lg hover-lift"
            >
                <i class="fas fa-route mr-3 text-xl" v-if="!isCalculating"></i>
                <span v-if="!isCalculating">Bereken Route & Kosten</span>
                <span v-else class="flex items-center">
                    <svg class="animate-spin h-6 w-6 mr-3" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Berekenen...
                </span>
            </button>
        </section>
        
        <!-- Result Section - Ultra Modern -->
        <section v-if="result" class="modern-card mb-8 animate-fade-in">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mr-3 shadow-lg">
                    <i class="fas fa-poll text-lg text-white"></i>
                </div>
                <span class="text-gradient">Route Resultaten</span>
            </h2>

            <div class="grid md:grid-cols-4 gap-4 mb-8">
                <div class="stat-card hover-lift">
                    <i class="fas fa-road"></i>
                    <div class="stat-label">Afstand</div>
                    <div class="stat-value">{{ result.distance }} <span class="text-xl">km</span></div>
                </div>

                <div class="stat-card hover-lift" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%)">
                    <i class="fas fa-clock"></i>
                    <div class="stat-label">Reistijd</div>
                    <div class="stat-value">{{ formatDuration(result.duration) }}</div>
                </div>

                <div class="stat-card hover-lift" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)">
                    <i class="fas fa-euro-sign"></i>
                    <div class="stat-label">Kosten</div>
                    <div class="stat-value">â‚¬ {{ result.cost }}</div>
                </div>

                <div class="stat-card hover-lift" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)">
                    <i class="fas fa-leaf"></i>
                    <div class="stat-label">COâ‚‚ Uitstoot</div>
                    <div class="stat-value">{{ result.co2 }} <span class="text-xl">kg</span></div>
                </div>
            </div>

            <!-- Map -->
            <div id="map" class="h-96"></div>
        </section>
        
        <!-- History Section - Modern -->
        <section id="history" class="modern-card mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-pink-600 rounded-2xl flex items-center justify-center mr-3 shadow-lg">
                        <i class="fas fa-history text-lg text-white"></i>
                    </div>
                    <span class="text-gradient">Ritgeschiedenis</span>
                </h2>
                <button
                    v-if="history.length > 0"
                    @click="exportHistory"
                    class="btn-secondary hover-lift flex items-center"
                >
                    <i class="fas fa-download mr-2"></i>
                    Exporteer CSV
                </button>
            </div>

            <div v-if="history.length === 0" class="text-center py-16 text-gray-400">
                <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-inbox text-5xl text-gray-300"></i>
                </div>
                <p class="text-lg font-medium">Nog geen ritten berekend</p>
                <p class="text-sm mt-2">Start door een route te berekenen</p>
            </div>

            <div v-else class="space-y-3">
                <div v-for="(trip, index) in reversedHistory"
                     :key="index"
                     class="history-item">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-semibold text-lg mb-2 flex items-center">
                                <i class="fas fa-route text-blue-500 mr-2"></i>
                                {{ trip.departure }} â†’ {{ trip.destination }}
                            </div>
                            <div class="flex flex-wrap gap-3 text-sm text-gray-600">
                                <span class="flex items-center">
                                    <i class="fas fa-road mr-1.5 text-purple-500"></i>
                                    <strong>{{ trip.distance }} km</strong>
                                </span>
                                <span class="flex items-center">
                                    <i class="fas fa-euro-sign mr-1.5 text-green-500"></i>
                                    <strong>â‚¬ {{ trip.cost }}</strong>
                                </span>
                                <span class="flex items-center">
                                    <i class="fas fa-gas-pump mr-1.5 text-blue-500"></i>
                                    {{ getFuelTypeName(trip.fuelType) }}
                                </span>
                                <span v-if="trip.gasStation" class="flex items-center">
                                    <i class="fas fa-building mr-1.5 text-orange-500"></i>
                                    {{ getStationName(trip.gasStation) }}
                                </span>
                                <span class="flex items-center">
                                    <i class="fas fa-calendar mr-1.5 text-gray-400"></i>
                                    {{ formatDate(trip.date) }}
                                </span>
                            </div>
                        </div>
                        <button
                            @click="deleteTrip(index)"
                            class="ml-4 w-10 h-10 flex items-center justify-center rounded-lg bg-red-50 text-red-500 hover:bg-red-100 hover:text-red-600 transition-all"
                            title="Verwijder rit"
                        >
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Chart Section - Modern -->
        <section id="chart" class="modern-card">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center mr-3 shadow-lg">
                    <i class="fas fa-chart-line text-lg text-white"></i>
                </div>
                <span class="text-gradient">Statistieken & Analyses</span>
            </h2>

            <div v-if="history.length === 0" class="text-center py-16 text-gray-400">
                <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-chart-area text-5xl text-gray-300"></i>
                </div>
                <p class="text-lg font-medium">Nog geen data beschikbaar</p>
                <p class="text-sm mt-2">Bereken enkele ritten om statistieken te zien</p>
            </div>

            <div v-else>
                <!-- Chart -->
                <div class="bg-gradient-to-br from-gray-50 to-white border border-gray-100 rounded-2xl p-6 mb-6">
                    <canvas id="costChart" style="max-height: 300px;"></canvas>
                </div>

                <!-- Summary Stats -->
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="stat-card hover-lift" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
                        <i class="fas fa-road"></i>
                        <div class="stat-label">Totale Afstand</div>
                        <div class="stat-value">{{ totalDistance }} <span class="text-xl">km</span></div>
                    </div>

                    <div class="stat-card hover-lift" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%)">
                        <i class="fas fa-euro-sign"></i>
                        <div class="stat-label">Totale Kosten</div>
                        <div class="stat-value">â‚¬ {{ totalCost }}</div>
                    </div>

                    <div class="stat-card hover-lift" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)">
                        <i class="fas fa-calculator"></i>
                        <div class="stat-label">Gem. Kosten/km</div>
                        <div class="stat-value">â‚¬ {{ avgCostPerKm }}</div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer - Modern -->
    <footer class="bg-gradient-to-r from-gray-50 to-gray-100 border-t border-gray-200 mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-3 mb-4 md:mb-0">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center shadow">
                        <i class="fas fa-gas-pump text-white"></i>
                    </div>
                    <div>
                        <div class="font-bold text-lg text-gradient">FuelTracker</div>
                        <div class="text-xs text-gray-500">Slimme brandstofkosten calculator</div>
                    </div>
                </div>

                <div class="text-center md:text-right">
                    <p class="text-sm text-gray-600 mb-2">&copy; 2025 FuelTracker. Alle rechten voorbehouden.</p>
                    <div class="flex items-center justify-center md:justify-end space-x-4 text-sm">
                        <a href="#" class="text-gray-500 hover:text-blue-500 transition-colors font-medium">Privacy</a>
                        <span class="text-gray-300">â€¢</span>
                        <a href="#" class="text-gray-500 hover:text-blue-500 transition-colors font-medium">Voorwaarden</a>
                        <span class="text-gray-300">â€¢</span>
                        <a href="#" class="text-gray-500 hover:text-blue-500 transition-colors font-medium">Contact</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Scripts -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="js/app.js"></script>
    <script>
        // Service worker registration with error handling
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/js/service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.warn('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>