<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bereken brandstofkosten voor uw reis met actuele prijzen en routeplanning">
    <meta name="theme-color" content="#1a202c">
    <title>FuelTracker - Brandstofkosten Calculator</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white dark:bg-gray-900 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="text-gray-600 dark:text-gray-400">Laden...</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-gas-pump text-2xl text-blue-500"></i>
                    <span class="text-xl font-bold">FuelTracker</span>
                </div>
                
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#calculator" class="nav-link">Calculator</a>
                    <a href="#history" class="nav-link">Geschiedenis</a>
                    <a href="#chart" class="nav-link">Statistieken</a>
                    <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-moon dark:hidden"></i>
                    </button>
                </div>
                
                <button class="md:hidden p-2" id="mobileMenuBtn">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden bg-white dark:bg-gray-800 border-t dark:border-gray-700">
            <div class="px-4 py-2 space-y-2">
                <a href="#calculator" class="block py-2 nav-link">Calculator</a>
                <a href="#history" class="block py-2 nav-link">Geschiedenis</a>
                <a href="#chart" class="block py-2 nav-link">Statistieken</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="app" class="container mx-auto px-4 py-8">
        <!-- Calculator Section -->
        <section id="calculator" class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-8">
            <h1 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-calculator mr-3 text-blue-500"></i>
                Brandstofkosten Calculator
            </h1>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Departure Input -->
                <div class="relative">
                    <label class="block text-sm font-medium mb-2">Vertrekpunt</label>
                    <div class="relative">
                        <input 
                            type="text" 
                            v-model="departure"
                            @input="searchDeparture"
                            @focus="departureFocused = true"
                            @blur="handleDepartureBlur"
                            placeholder="Straat, stad of postcode..."
                            class="w-full px-4 py-3 pr-10 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600"
                            required
                        >
                        <i class="fas fa-map-marker-alt absolute right-3 top-3.5 text-gray-400"></i>
                    </div>
                    
                    <!-- Departure Suggestions -->
                    <div v-if="departureSuggestions.length > 0 && departureFocused" 
                         class="absolute z-10 w-full mt-1 bg-white dark:bg-gray-700 border dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                        <div v-for="(suggestion, index) in departureSuggestions" 
                             :key="index"
                             @click="selectDeparture(suggestion)"
                             class="px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer border-b dark:border-gray-600 last:border-b-0">
                            <div class="font-medium">{{ suggestion.name }}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">{{ suggestion.display_name }}</div>
                        </div>
                    </div>
                </div>
                
                <!-- Destination Input -->
                <div class="relative">
                    <label class="block text-sm font-medium mb-2">Bestemming</label>
                    <div class="relative">
                        <input 
                            type="text" 
                            v-model="destination"
                            @input="searchDestination"
                            @focus="destinationFocused = true"
                            @blur="handleDestinationBlur"
                            placeholder="Straat, stad of postcode..."
                            class="w-full px-4 py-3 pr-10 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600"
                            required
                        >
                        <i class="fas fa-map-marker-alt absolute right-3 top-3.5 text-gray-400"></i>
                    </div>
                    
                    <!-- Destination Suggestions -->
                    <div v-if="destinationSuggestions.length > 0 && destinationFocused" 
                         class="absolute z-10 w-full mt-1 bg-white dark:bg-gray-700 border dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                        <div v-for="(suggestion, index) in destinationSuggestions" 
                             :key="index"
                             @click="selectDestination(suggestion)"
                             class="px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer border-b dark:border-gray-600 last:border-b-0">
                            <div class="font-medium">{{ suggestion.name }}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">{{ suggestion.display_name }}</div>
                        </div>
                    </div>
                </div>
                
                <!-- Fuel Consumption Input -->
                <div>
                    <label class="block text-sm font-medium mb-2">Brandstofverbruik (L/100km)</label>
                    <div class="relative">
                        <input 
                            type="number" 
                            v-model.number="consumption"
                            min="2"
                            max="25"
                            step="0.1"
                            placeholder="Bijv. 6.5"
                            class="w-full px-4 py-3 pr-10 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600"
                            required
                        >
                        <i class="fas fa-gas-pump absolute right-3 top-3.5 text-gray-400"></i>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Gemiddeld: 5-8 L/100km</p>
                </div>
                
                <!-- Fuel Type Select -->
                <div>
                    <label class="block text-sm font-medium mb-2">Brandstoftype</label>
                    <select
                        v-model="fuelType"
                        class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600"
                    >
                        <option value="euro95">Euro 95 (E10)</option>
                        <option value="euro98">Euro 98 (E5)</option>
                        <option value="diesel">Diesel (B7)</option>
                        <option value="lpg">LPG</option>
                    </select>
                </div>

                <!-- Gas Station Select -->
                <div>
                    <label class="block text-sm font-medium mb-2">Tankstation</label>
                    <select
                        v-model="gasStation"
                        class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600"
                    >
                        <option value="average">Gemiddelde prijs</option>
                        <option value="shell">Shell</option>
                        <option value="totalenergies">TotalEnergies</option>
                        <option value="q8">Q8</option>
                        <option value="esso">Esso</option>
                        <option value="gabriels">Gabriels</option>
                        <option value="octaplus">Octa+</option>
                        <option value="dats24">Dats 24</option>
                        <option value="lukoil">Lukoil</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Selecteer je voorkeur tankstation voor tracking</p>
                </div>
            </div>
            
            <!-- Fuel Price Display -->
            <div v-if="currentFuelPrice" class="mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex items-center">
                            <span class="text-sm font-medium">Huidige brandstofprijs</span>
                            <span v-if="gasStation !== 'average'" class="text-xs text-gray-600 dark:text-gray-400 ml-1">({{ getStationName(gasStation) }})</span>
                            <span class="text-sm font-medium">:</span>
                        </div>
                        <span class="font-bold text-lg">€ {{ currentFuelPrice.toFixed(3) }}/L</span>
                    </div>
                    <button
                        @click="refreshFuelPrice"
                        :disabled="isRefreshingPrice"
                        class="px-3 py-1.5 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 text-white text-sm rounded-lg transition-colors flex items-center"
                        title="Ververs brandstofprijs"
                    >
                        <i class="fas fa-sync-alt mr-1.5" :class="{ 'animate-spin': isRefreshingPrice }"></i>
                        <span v-if="!isRefreshingPrice">Ververs</span>
                        <span v-else>Laden...</span>
                    </button>
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                    <i class="fas fa-clock mr-1"></i>
                    Laatst bijgewerkt: {{ lastPriceUpdate }}
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    <i class="fas fa-info-circle mr-1"></i>
                    Officiële gemiddelde prijzen via StatBel API - Automatisch bijgewerkt elke 6 uur
                </div>
            </div>
            
            <!-- Calculate Button -->
            <button 
                @click="calculateTrip"
                :disabled="isCalculating || !departure || !destination || !consumption"
                class="w-full mt-6 py-3 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 text-white font-medium rounded-lg transition-colors flex items-center justify-center"
            >
                <i class="fas fa-route mr-2" v-if="!isCalculating"></i>
                <span v-if="!isCalculating">Bereken Route & Kosten</span>
                <span v-else class="flex items-center">
                    <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Berekenen...
                </span>
            </button>
        </section>
        
        <!-- Result Section -->
        <section v-if="result" class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-8 animate-fade-in">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-poll mr-3 text-green-500"></i>
                Resultaten
            </h2>
            
            <div class="grid md:grid-cols-4 gap-4">
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                    <i class="fas fa-road text-2xl text-blue-500 mb-2"></i>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Afstand</p>
                    <p class="text-2xl font-bold">{{ result.distance }} km</p>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                    <i class="fas fa-clock text-2xl text-purple-500 mb-2"></i>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Reistijd</p>
                    <p class="text-2xl font-bold">{{ formatDuration(result.duration) }}</p>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                    <i class="fas fa-euro-sign text-2xl text-green-500 mb-2"></i>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Kosten</p>
                    <p class="text-2xl font-bold">€ {{ result.cost }}</p>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                    <i class="fas fa-leaf text-2xl text-green-600 mb-2"></i>
                    <p class="text-sm text-gray-600 dark:text-gray-400">CO₂ Uitstoot</p>
                    <p class="text-2xl font-bold">{{ result.co2 }} kg</p>
                </div>
            </div>
            
            <!-- Map -->
            <div id="map" class="mt-6 h-96 rounded-lg overflow-hidden"></div>
        </section>
        
        <!-- History Section -->
        <section id="history" class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold flex items-center">
                    <i class="fas fa-history mr-3 text-orange-500"></i>
                    Geschiedenis
                </h2>
                <button 
                    v-if="history.length > 0"
                    @click="exportHistory"
                    class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-sm transition-colors"
                >
                    <i class="fas fa-download mr-2"></i>
                    Exporteer CSV
                </button>
            </div>
            
            <div v-if="history.length === 0" class="text-center py-8 text-gray-500 dark:text-gray-400">
                <i class="fas fa-inbox text-4xl mb-3"></i>
                <p>Nog geen ritten berekend</p>
            </div>
            
            <div v-else class="space-y-3">
                <div v-for="(trip, index) in reversedHistory" 
                     :key="index"
                     class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-medium mb-1">
                                <i class="fas fa-map-marker-alt text-blue-500 mr-1"></i>
                                {{ trip.departure }} → {{ trip.destination }}
                            </div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 space-x-4">
                                <span><i class="fas fa-road mr-1"></i>{{ trip.distance }} km</span>
                                <span><i class="fas fa-euro-sign mr-1"></i>{{ trip.cost }}</span>
                                <span><i class="fas fa-gas-pump mr-1"></i>{{ getFuelTypeName(trip.fuelType) }}</span>
                                <span v-if="trip.gasStation"><i class="fas fa-building mr-1"></i>{{ getStationName(trip.gasStation) }}</span>
                                <span><i class="fas fa-calendar mr-1"></i>{{ formatDate(trip.date) }}</span>
                            </div>
                        </div>
                        <button 
                            @click="deleteTrip(index)"
                            class="ml-4 text-red-500 hover:text-red-700 transition-colors"
                        >
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Chart Section -->
        <section id="chart" class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-chart-line mr-3 text-purple-500"></i>
                Statistieken
            </h2>
            
            <div v-if="history.length === 0" class="text-center py-8 text-gray-500 dark:text-gray-400">
                <i class="fas fa-chart-area text-4xl mb-3"></i>
                <p>Nog geen data beschikbaar</p>
            </div>
            
            <div v-else>
                <canvas id="costChart" class="mb-6"></canvas>
                
                <div class="grid md:grid-cols-3 gap-4 mt-6">
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                        <p class="text-sm text-gray-600 dark:text-gray-400">Totale Afstand</p>
                        <p class="text-2xl font-bold">{{ totalDistance }} km</p>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                        <p class="text-sm text-gray-600 dark:text-gray-400">Totale Kosten</p>
                        <p class="text-2xl font-bold">€ {{ totalCost }}</p>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center">
                        <p class="text-sm text-gray-600 dark:text-gray-400">Gemiddelde Kosten/km</p>
                        <p class="text-2xl font-bold">€ {{ avgCostPerKm }}</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800 shadow-lg mt-8">
        <div class="container mx-auto px-4 py-6">
            <div class="text-center text-gray-600 dark:text-gray-400">
                <p>&copy; 2025 FuelTracker. Alle rechten voorbehouden.</p>
                <p class="text-sm mt-2">
                    <a href="#" class="hover:text-blue-500 transition-colors">Privacy</a>
                    <span class="mx-2">•</span>
                    <a href="#" class="hover:text-blue-500 transition-colors">Voorwaarden</a>
                    <span class="mx-2">•</span>
                    <a href="#" class="hover:text-blue-500 transition-colors">Contact</a>
                </p>
            </div>
        </div>
    </footer>
    
    <!-- Scripts -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="js/app.js"></script>
    <script>
        // Service worker registration with error handling
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/js/service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.warn('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>